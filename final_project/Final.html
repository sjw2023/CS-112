<!DOCTYPE html>
<meta charset="UTF-8">
<html>

<head>
    <title>Final Assignment</title>
    <style>
        body {
        background-color: #EEEEEE;
    }
    label {
        white-space: pre;
    }
</style>

    <!-- vertex shader -->
    <script type="x-shader/x-vertex" id="vshader-source">
    attribute vec3 a_coords;
    attribute vec3 a_normal;
    attribute vec3 color;

    /////Matrices//////
    uniform mat4 modelView;
    uniform mat4 projection;
    uniform mat3 normalMatrix;
    uniform mat4 viewMatrix;

    ////////Lighting Variables
    uniform vec4 lightPosition;
    uniform vec4 pointLightPosition;
    /////////Moon/////////
    uniform float isMoonDown;
    uniform float isHeadLight;
    uniform float isPointLight;
    //////spot light///////
    uniform vec4 carHeadLightPosition;
    uniform vec3 carLightDirection;
    vec4 lightPos;
    vec3 lightDir;
    ////////////////////////
    varying vec3 v_N;
    varying vec3 v_L;
    varying vec3 v_R;
    varying vec3 v_V;
    varying vec3 v_lDir;
    varying float v_distance;
    varying float v_isSunDown;
    varying float v_isPointLight;

    varying vec4 v_color;
    vec4 coords ;
    vec4 eyeCoords ;

    vec3 c_distance(vec3 color, float distance)
    {
        if(distance > 0. && distance < 0.5)
        {
            return vec3(vec3(1,1,1)*0.9);
        }
        else if(distance > 0.5 && distance <= 1.)
        {
            return vec3(vec3(0,1,1)*0.1);
        }
        else if(distance > 1. && distance <= 1.5)
        {
            return vec3(vec3(1,0,1)*0.2);
        }
        else if(distance > 1.5 && distance <= 2.)
        {
            return vec3(vec3(1,1,0)*0.3);
        }
        else if(distance > 2. && distance <= 2.5)
        {
            return vec3(vec3(1,0,0)*0.4);
        }
        else if(distance > 2.5 && distance <= 3.)
        {
            return vec3(vec3(0,1,0)*0.5);
        }
        else if(distance > 3. && distance <= 3.5)
        {
            return vec3(vec3(0,0,1)*0.6);
        }
        else if(distance > 3.5 && distance <= 4.)
        {
            return vec3(vec3(0,0,0)*0.7);
        }
        else if(distance > 4. && distance <= 4.5)
        {
            return vec3(color*0.8);
        }
        else
        {
            return vec3(color);
        }

    }
    void main() {
        vec3 N, L, R, V;// vectors for lighting equation
        coords = vec4(a_coords,1.0);
        eyeCoords = modelView * coords;//transformed position of vertex
        gl_Position = projection * eyeCoords;

        if(isMoonDown == 1.){
            lightPos = pointLightPosition;
            if( isPointLight == 1. ){
                // lightPos = pointLightPosition;
            }
            else{
                // lightPos = carHeadLightPosition;
            }
        }
        else{
            lightPos = lightPosition;
        }
        if ( lightPos.w == 0. ) {//Directional Light
            L = normalize( lightPos.xyz );
        }
        else {//Other lithgts( spot and point )
            L = normalize( ( lightPos.xyz/lightPos.w - eyeCoords.xyz ) );
        }
        N = normalize( normalMatrix * a_normal );
        R = normalize(reflect(-L,N));
        V = normalize( -eyeCoords.xyz);     // (Assumes a perspective projection.)

        v_N = N;
        v_L = L;
        v_R = R;
        v_V = V;
        v_color = vec4( color, 1. );
        v_lDir = normalize( carLightDirection );
        v_distance = length( lightPos.xyz - eyeCoords.xyz );
        v_isSunDown = isMoonDown;
        v_isPointLight = isPointLight;
    }
</script>

    <!-- fragment shader -->
    <script type="x-shader/x-fragment" id="fshader-source">
        #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif
    varying vec4 v_color;
    varying vec3 v_N;
    varying vec3 v_L;
    varying vec3 v_R;
    varying vec3 v_V;
    varying float v_distance;
    varying vec3 v_lDir;
    varying float v_isSunDown;
    varying float v_isPointLight;


    // uniform vec4 carHeadLightPosition;

    uniform vec3 ambientColor;
    uniform vec4 diffuseColor;
    uniform vec3 specularColor;
    uniform float specularExponent;
    uniform float u_limit;
    uniform float isMoon;
    // uniform vec3 carLightDirection;

    void coloringWithSun(in vec3 N, in vec3 L, in vec3 R, in vec3 V, in float isSun, in float isPointLight, in vec3 color){
        /////Directional Lighting
        vec3 o_color = color;
        float diffuseLightWeighting = max(dot(N, L), 0.0);
        float specularLightWeighting = pow(max(dot(R, V), 0.0), 10.);
        float attetuationLightWeighting;
        if( isSun == 1. ){
            attetuationLightWeighting = 1.; //This set Sun and PointLight as emitted object
        }
        if( isPointLight == 1. ){
            attetuationLightWeighting = 0.;/// turnOff the point light
        }
        else{
            attetuationLightWeighting = clamp( 8. / v_distance, 0.0, 1.0);//1.0/(1.0+(0.25*pow(v_distance,2.0)));
        }
        gl_FragColor = vec4((o_color) * attetuationLightWeighting+ ((diffuseColor.rgb) * diffuseLightWeighting *attetuationLightWeighting) + ((specularColor) * specularLightWeighting*attetuationLightWeighting), 1.0);
    }
    void coloringWithPointLight(in vec3 N, in vec3 L, in vec3 R, in vec3 V, in float isPointLight, in float isSun ){
        /////Point Lighting basically same with Directional lighting but diffrent in direction of light
        float diffuseLightWeighting = max(dot(N, L), 0.0);
        float specularLightWeighting = pow(max(dot(R, V), 0.0), 10.);
        float attetuationLightWeighting;
        if( isPointLight == 1. ){
            attetuationLightWeighting = 1.; //This set Sun and PointLight as emitted object
        }
        if( isSun == 1. ){
            attetuationLightWeighting = 1.;
        }
        else{
            attetuationLightWeighting = clamp( 1. / v_distance, 0.0, 1.0);//1.0/(1.0+(0.25*pow(v_distance,2.0)));
        }
        gl_FragColor = vec4((v_color.rgb) * attetuationLightWeighting+ ((diffuseColor.rgb) * diffuseLightWeighting *attetuationLightWeighting) + ((specularColor) * specularLightWeighting*attetuationLightWeighting), 1.0);
    }
    void drawLightMoonDown(in vec3 N, in vec3 L, in vec3 R, in vec3 V, in vec3 lDir){
        // float ambient = color * 1.;
        float diffuseLightWeighting = max(dot(N, L), 0.0);
        float specularLightWeighting = pow(max(dot(R, V), 0.0), specularExponent);
        float angle = dot( -L, lDir);
        if( angle > u_limit )
        {
            gl_FragColor = vec4( ( vec3(v_color) + (vec3(1,1,1)*angle)), 1.0);
            // gl_FragColor = vec4( ( vec3(v_color) + (vec3(1,1,1)*v_distance)), 1.0);
            // gl_FragColor = vec4( ( vec3(v_color) + ((diffuseColor.rgb) * diffuseLightWeighting) + ((specularColor) * specularLightWeighting) + (vec3(1,1,1)*angle)), 1.0);
        }
        // else
        // {
        gl_FragColor = vec4( ( vec3(v_color) + (vec3(1,1,1)*angle)), 1.0);
        // gl_FragColor = vec4( v_distance*vec3(0,0,0), 1.);
            // gl_FragColor = vec4( ( vec3(v_color) + ((diffuseColor.rgb) * diffuseLightWeighting) + ((specularColor) * specularLightWeighting) ), 1.0);
        // }
    }
    void main(){
        if( v_isSunDown == 0. ){
            coloringWithSun( v_N, v_L, v_R, v_V, isMoon, v_isPointLight, v_color.rgb);
        }
        else{
            // drawLightMoonDown(v_N, v_L, v_R, v_V, v_lDir);
            coloringWithPointLight(v_N, v_L, v_R, v_V, v_isPointLight, isMoon );
        }
    }
</script>

    <script src="gl-matrix-min.js"></script>
    <script type="text/javascript" src="webgl-utils.js"></script>
    <script src="models.js"></script>
    <script src="Final.js"></script>
    <script src="trackball-rotator.js"></script>
    <script src="rendering-car.js"></script>
    <script src="rendering-ground.js"></script>
    <script src="draw-tree.js"></script>
    <script src="draw-models.js"></script>
    <script src="draw-pole.js"></script>
    <script src="draw-moon.js"></script>
    <script src="color-for-objects.js"></script>

</head>

<body onload="startup()">
    Name: joowon suh<br />
    Student ID: 44414081 X0992979<br />
    <div id="canvas-holder">
        <canvas width=700 height=700 id="myGLCanvas" style="background-color:red"></canvas>
    </div>
</body>

</html>
